---
title: "Analysis of U.S. Storm Event Data and the Impact on Public Health and the Economy"
author: "Jeffrey Hunter"
date: "4/26/2019"
output:
  html_document:
    df_print: paged
  pdf_document: default
  html_notebook: default
  pdf_notebook: default
---

## Table of Contents

[Synonpsis](#synonpsis)<br />
[Set Up Environment](#set-up-environment)<br />
[Load Data](#load-data)<br />
[Data Processing](#data-processing)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Create Subset of Data](#create-subset-of-data)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Clean Event Type Data](#clean-event-type-data)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Clean Economic Data](#clean-economic-data)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Clean Date Data](#clean-date-data)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Impact on Public Health](#impact-on-public-health)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Impact on Economy](#impact-on-economy)<br />
[Results](#results)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Event Types Most Harmful to Population Health](#event-types-most-harmful-to-population-health)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Event Types with Greatest Economic Consequences](#event-types-with-greatest-economic-consequences)<br />
[Conclusion](#conclusion)

## Synonpsis

Storms and other severe weather events can cause both public health and economic
problems for communities and municipalities. Many severe events can result in
fatalities, injuries, and property damage, and preventing such outcomes to the
extent possible is a key concern.

This report contains the results of an analysis where the goal was to identify
the most hazardous weather events with respect to public health and those with
the greatest economic impact in the U.S. based on data collected from the U.S.
National Oceanic and Atmospheric Administration's (NOAA).

The storm database includes weather events from 1950 through the year 2011 and
contains data estimates such as the number fatalities and injuries for each
weather event as well as economic damage on properties and crops.

The estimates for fatalities, injuries, property and crop damage was used
to determine the most harmful impact to both public health and the economy.

The results in this report found that excessive heat and tornado were most
harmful with respect to public health, while flood, drought, and
hurricane/typhoon had the greatest economic impact.

## Set Up Environment

Disable warnings

```{r setup, include = TRUE}
knitr::opts_chunk$set(echo = FALSE)
```

Load libraries

```{r, echo = TRUE}
options(scipen = 1) # disable scientific notation for numbers
library(dplyr, warn.conflicts = FALSE)
library(ggplot2)
```

Session information

```{r, echo = TRUE}
sessionInfo()
```

## Load Data

Download the compressed data file from the source URL (if not found locally) and
then load the compressed data file via `read.csv`. Prior to processing
the data, validate the downloaded data file and loaded dataset by checking the file 
size and dimensions respectively.

```{r, echo = TRUE, cache = TRUE}
setwd("~jhunter/repos/coursera/reproducible-research-course-project-2")
stormDataFileURL <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
stormDataFile <- "data/storm-data.csv.bz2"
if (!file.exists('data')) {
    dir.create('data')
}
if (!file.exists(stormDataFile)) {
    download.file(url = stormDataFileURL, destfile = stormDataFile)
}
stormData <- read.csv(stormDataFile, sep = ",", header = TRUE)
stopifnot(file.size(stormDataFile) == 49177144) 
stopifnot(dim(stormData) == c(902297,37))
```

Display dataset summary

```{r, echo = TRUE}
names(stormData)
```

```{r, echo = TRUE}
str(stormData)
```

```{r, echo = TRUE}
summary(stormData)
```

```{r, echo = TRUE}
head(stormData)
```

## Data Processing

### Create Subset of Data

When processing a large dataset, compute performance can be improved by taking a
subset of the variables associated to the population and economy damage. For
this analysis, the dataset will be trimmed to only include the necessary
variables (listed below). In addition, only observations with `value > 0` will
be included.

| Variable     | Description                                       |
|--------------|---------------------------------------------------|
| EVTYPE       | Event type (Flood, Heat, Hurricane, Tornado, ...) |
| FATALITIES   | Number of fatalities resulting from event         |
| INJURIES     | Number of injuries resulting from event           |
| PROPDMG      | Property damage in USD                            |
| PROPDMGEXP   | Units for property damage (K, M, or B)            |
| CROPDMG      | Crop damage in USD                                |
| CROPDMGEXP   | Unit for crop damage (K, M, or B)                 |
| BGN_DATE     | Begin date of the event                           |
| END_DATE     | End date of the event                             |
| STATE        | State where the event occurred                    |

```{r, echo = TRUE}
stormDataTidy <- subset(stormData, EVTYPE != "?"
                                   &
                                   (FATALITIES > 0 | INJURIES > 0 | PROPDMG > 0 | CROPDMG > 0),
                                   select = c("EVTYPE",
                                              "FATALITIES",
                                              "INJURIES", 
                                              "PROPDMG",
                                              "PROPDMGEXP",
                                              "CROPDMG",
                                              "CROPDMGEXP",
                                              "BGN_DATE",
                                              "END_DATE",
                                              "STATE"))
dim(stormDataTidy)
sum(is.na(stormDataTidy))
```

The working (tidy) dataset contains 254632 observations, 10 variables and no
missing values.

### Clean Event Type Data

There are a total of 487 unique Event Type values in the current tidy dataset.

```{r, echo = TRUE}
length(unique(stormDataTidy$EVTYPE))
```

Exploring the Event Type data revealed many values that appeared to be similar;
however, they were entered with different spellings, pluralization, mixed
case and even misspellings. For example, `Strong Wind`, `STRONG WIND`,
`Strong Winds`, and `STRONG WINDS`.

The dataset was normalized by converting all Event Type values to uppercase and
combining similar Event Type values into unique categories.

```{r, echo = TRUE}
stormDataTidy$EVTYPE <- toupper(stormDataTidy$EVTYPE)
```

```{r, echo = TRUE}
# avalanche
stormDataTidy$EVTYPE <- gsub('.*AVALANCE.*', 'AVALANCHE', stormDataTidy$EVTYPE)
# blizzard
stormDataTidy$EVTYPE <- gsub('.*BLIZZARD.*', 'BLIZZARD', stormDataTidy$EVTYPE)
# cloud
stormDataTidy$EVTYPE <- gsub('.*CLOUD.*', 'CLOUD', stormDataTidy$EVTYPE)
# cold
stormDataTidy$EVTYPE <- gsub('.*COLD.*', 'COLD', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('.*FREEZ.*', 'COLD', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('.*FROST.*', 'COLD', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('.*ICE.*', 'COLD', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('.*LOW TEMPERATURE RECORD.*', 'COLD', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('.*LO.*TEMP.*', 'COLD', stormDataTidy$EVTYPE)
# dry
stormDataTidy$EVTYPE <- gsub('.*DRY.*', 'DRY', stormDataTidy$EVTYPE)
# dust
stormDataTidy$EVTYPE <- gsub('.*DUST.*', 'DUST', stormDataTidy$EVTYPE)
# fire
stormDataTidy$EVTYPE <- gsub('.*FIRE.*', 'FIRE', stormDataTidy$EVTYPE)
# flood
stormDataTidy$EVTYPE <- gsub('.*FLOOD.*', 'FLOOD', stormDataTidy$EVTYPE)
# fog
stormDataTidy$EVTYPE <- gsub('.*FOG.*', 'FOG', stormDataTidy$EVTYPE)
# hail
stormDataTidy$EVTYPE <- gsub('.*HAIL.*', 'HAIL', stormDataTidy$EVTYPE)
# heat / extreme heat
stormDataTidy$EVTYPE <- gsub('.*HEAT.*', 'HEAT', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('.*WARM.*', 'HEAT', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('.*HIGH.*TEMP.*', 'EXTREME HEAT', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('.*RECORD HIGH TEMPERATURES.*', 'EXTREME HEAT', stormDataTidy$EVTYPE)
# hypothermia/exposure
stormDataTidy$EVTYPE <- gsub('.*HYPOTHERMIA.*', 'HYPOTHERMIA/EXPOSURE', stormDataTidy$EVTYPE)
# landslide
stormDataTidy$EVTYPE <- gsub('.*LANDSLIDE.*', 'LANDSLIDE', stormDataTidy$EVTYPE)
# lightning
stormDataTidy$EVTYPE <- gsub('^LIGHTNING.*', 'LIGHTNING', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('^LIGNTNING.*', 'LIGHTNING', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('^LIGHTING.*', 'LIGHTNING', stormDataTidy$EVTYPE)
# microburst
stormDataTidy$EVTYPE <- gsub('.*MICROBURST.*', 'MICROBURST', stormDataTidy$EVTYPE)
# mudslide
stormDataTidy$EVTYPE <- gsub('^MUDSLIDE.*', 'MUDSLIDE', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('^MUD SLIDE.*', 'MUDSLIDE', stormDataTidy$EVTYPE)
# rain
stormDataTidy$EVTYPE <- gsub('.*RAIN.*', 'RAIN', stormDataTidy$EVTYPE)
# rip current
stormDataTidy$EVTYPE <- gsub('.*RIP CURRENT.*', 'RIP CURRENT', stormDataTidy$EVTYPE)
# storm
stormDataTidy$EVTYPE <- gsub('.*STORM.*', 'STORM', stormDataTidy$EVTYPE)
# summary
stormDataTidy$EVTYPE <- gsub('.*SUMMARY.*', 'SUMMARY', stormDataTidy$EVTYPE)
# tornado
stormDataTidy$EVTYPE <- gsub('.*TORNADO.*', 'TORNADO', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('.*TORNDAO.*', 'TORNADO', stormDataTidy$EVTYPE)
# surf
stormDataTidy$EVTYPE <- gsub('.*SURF.*', 'SURF', stormDataTidy$EVTYPE)
# volcanic
stormDataTidy$EVTYPE <- gsub('.*VOLCANIC.*', 'VOLCANIC', stormDataTidy$EVTYPE)
# waterspout
stormDataTidy$EVTYPE <- gsub('.*WATERSPOUT.*', 'WATERSPOUT', stormDataTidy$EVTYPE)
# wet
stormDataTidy$EVTYPE <- gsub('.*WET.*', 'WET', stormDataTidy$EVTYPE)
# wind
stormDataTidy$EVTYPE <- gsub('.*WIND.*', 'WIND', stormDataTidy$EVTYPE)
# winter
stormDataTidy$EVTYPE <- gsub('.*WINTER.*', 'WINTER', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('.*WINTRY.*', 'WINTER', stormDataTidy$EVTYPE)
stormDataTidy$EVTYPE <- gsub('.*SNOW.*', 'COLD', stormDataTidy$EVTYPE)
```

After tidying the dataset, the number of unique Event Type values were reduced
to 83.

```{r, echo = TRUE}
length(unique(stormDataTidy$EVTYPE))
```

### Clean Date Data

Format date variables for any type of optional reporting or further analysis.

In the raw dataset, the `BNG_START` and `END_DATE` variables are stored as
factors which should be made available as actual *date* types that can be
manipulated and reported on. For now, time variables will be ignored.

Create four new variables based on date variables in the tidy dataset:

| Variable     | Description                                   |
|--------------|-----------------------------------------------|
| DATE_START   | Begin date of the event stored as a date type |
| DATE_END     | End date of the event stored as a date type   |
| YEAR         | Year the event started                        |
| DURATION     | Duration (in hours) of the event              |

```{r, echo = TRUE}
stormDataTidy$DATE_START <- as.Date(stormDataTidy$BGN_DATE, format = "%m/%d/%Y")
stormDataTidy$DATE_END <- as.Date(stormDataTidy$END_DATE, format = "%m/%d/%Y")
stormDataTidy$YEAR <- as.integer(format(stormDataTidy$DATE_START, "%Y"))
stormDataTidy$DURATION <- as.numeric(stormDataTidy$DATE_END - stormDataTidy$DATE_START)/3600
```

### Clean Economic Data

*Pending*

### Impact on Public Health

*pending*

### Impact on Economy

*pending*

## Results

### Event Types Most Harmful to Population Health

*pending*

### Event Types with Greatest Economic Consequences

*pending*

## Conclusion

*pending*





